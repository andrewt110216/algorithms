import pytest
from pathlib import Path
from algorithms.dijkstra_min_path import read_graph, dijkstra


@pytest.fixture(scope="session")
def simple_graph_input(tmp_path_factory):
    fn = tmp_path_factory.getbasetemp() / "simple_graph_input.txt"
    with open(fn, "w") as f:
        f.write("1 2,100 3,50\n")
        f.write("2 1,100 3,25\n")
        f.write("3 1,50 2,25")
    return fn


@pytest.fixture(scope="session")
def moderate_graph_input(tmp_path_factory):
    fn = tmp_path_factory.getbasetemp() / "moderate_graph_input.txt"
    with open(fn, "w") as f:
        f.write("1 2,10 3,2\n")
        f.write("2 1,10 3,20 4,5 5,50\n")
        f.write("3 1,2 2,20 4,12\n")
        f.write("4 2,5 3,12 5,30\n")
        f.write("5 2,50 4,30\n")
    return fn


class TestCase:
    def test_read_graph_simple_graph(self, simple_graph_input):
        edges = [[(2, 100), (3, 50)], [(1, 100), (3, 25)], [(1, 50), (2, 25)]]
        assert read_graph(str(simple_graph_input), 3) == edges

    def test_dijkstra_simple(self, simple_graph_input):
        E = read_graph(str(simple_graph_input), 3)
        assert dijkstra(E, 3) == [0, 75, 50]

    def test_dijkstra_moderate(self, moderate_graph_input):
        E = read_graph(str(moderate_graph_input), 5)
        assert dijkstra(E, 5) == [0, 10, 2, 14, 44]

    def test_dijkstra_large(self):
        BASE = Path(__file__).resolve().parent.parent
        E = read_graph(
            str(BASE / "algorithms/input-files/dijkstra_input.txt"), 200
            )
        assert dijkstra(E, 200) == [
            0,
            2971,
            2644,
            3056,
            2525,
            2818,
            2599,
            1875,
            745,
            3205,
            1551,
            2906,
            2394,
            1803,
            2942,
            1837,
            3111,
            2284,
            1044,
            2351,
            3630,
            4028,
            2650,
            3653,
            2249,
            2150,
            1222,
            2090,
            3540,
            2303,
            3455,
            3004,
            2551,
            2656,
            998,
            2236,
            2610,
            3548,
            1851,
            4091,
            2732,
            2040,
            3312,
            2142,
            3438,
            2937,
            2979,
            2757,
            2437,
            3152,
            2503,
            2817,
            2420,
            3369,
            2862,
            2609,
            2857,
            3668,
            2947,
            2592,
            1676,
            2573,
            2498,
            2047,
            826,
            3393,
            2535,
            4636,
            3650,
            743,
            1265,
            1539,
            3007,
            4286,
            2720,
            3220,
            2298,
            2795,
            2806,
            982,
            2976,
            2052,
            3997,
            2656,
            1193,
            2461,
            1608,
            3046,
            3261,
            2018,
            2786,
            647,
            3542,
            3415,
            2186,
            2398,
            4248,
            3515,
            2367,
            2970,
            3536,
            2478,
            1826,
            2551,
            3368,
            2303,
            2540,
            1169,
            3140,
            2317,
            2535,
            1759,
            1899,
            508,
            2399,
            3513,
            2597,
            2176,
            1090,
            2328,
            2818,
            1306,
            2805,
            2057,
            2618,
            1694,
            3285,
            1203,
            676,
            1820,
            1445,
            2468,
            2029,
            1257,
            1533,
            2417,
            3599,
            2494,
            4101,
            546,
            1889,
            2616,
            2141,
            2359,
            648,
            2682,
            3464,
            2873,
            3109,
            2183,
            4159,
            1832,
            2080,
            1831,
            2001,
            3013,
            2143,
            1376,
            1627,
            2403,
            4772,
            2556,
            2124,
            1693,
            2442,
            3814,
            2630,
            2038,
            2776,
            1365,
            3929,
            1990,
            2069,
            3558,
            1432,
            2279,
            3829,
            2435,
            3691,
            3027,
            2345,
            3807,
            2145,
            2703,
            2884,
            3806,
            1151,
            2505,
            2340,
            2596,
            4123,
            1737,
            3136,
            1073,
            1707,
            2417,
            3068,
            1724,
            815,
            2060,
        ]
